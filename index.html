<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER CHALLENGE - Boss Fight Finale</title>
    <style id="dynamic-style"></style>
</head>
<body>
    <canvas class="matrix-bg" id="matrix"></canvas>
    
    <div class="container" id="gameContainer">
        <h1 id="mainTitle">⚡ CYBER CHALLENGE ⚡</h1>
        <p class="subtitle">Decodifica il mistero nascosto...</p>
        
        <div id="startScreen" class="start-screen">
            <h2>Benvenuto in CYBER CHALLENGE</h2>
            <p class="start-description">Metti alla prova le tue abilità di critto-hacker: decodifica cifrature, supera i livelli e sconfiggi il Boss finale.</p>
            <div class="start-buttons">
                <button id="startGameBtn">Inizia nuova sfida</button>
                <button id="continueGameBtn" class="hidden">Continua partita</button>
            </div>
        </div>

        <div class="stats hidden" id="statsPanel">
            <div class="stat-item">
                <div class="stat-label">LIVELLO</div>
                <div class="stat-value" id="levelDisplay">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">TENTATIVI FALLITI</div>
                <div class="stat-value" id="failedAttempts">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">STRINGHE RISOLTE</div>
                <div class="stat-value" id="totalSolved">0</div>
            </div>
        </div>

        <div id="gameContent"></div>
        
        <!-- Tutorial rimosso -->
    </div>

    <!-- Bottone help rimosso -->

    <button id="guideFab" class="guide-fab" aria-label="Guida alle cifrature" title="Guida alle cifrature">?</button>

    <script>
        // Funzione per decodificare stringhe offuscate
        function decode(encoded) {
            return atob(encoded);
        }

        // Funzione per applicare gli stili
        function applyStyles(css) {
            const style = document.createElement('style');
            style.textContent = css;
            document.head.appendChild(style);
            document.body.style.visibility = 'visible';
        }

        // Funzione per caricare il JavaScript offuscato
        function loadScript(encodedScript) {
            const script = document.createElement('script');
            script.text = atob(encodedScript);
            document.body.appendChild(script);
        }

        // Funzione per inizializzare l'applicazione
        function initApp() {
            // Carica i font di Google
            const fontLink = document.createElement('link');
            fontLink.href = 'https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@400;600&display=swap';
            fontLink.rel = 'stylesheet';
            document.head.appendChild(fontLink);

            // Carica il CSS dal file esterno
            fetch('style.css')
                .then(response => response.text())
                .then(css => {
                    // Codifica il CSS in base64 per nasconderlo
                    const encodedCss = btoa(unescape(encodeURIComponent(css)));
                    // Applica gli stili decodificandoli al volo
                    applyStyles(decode(encodedCss));
                    
                    // Dopo aver caricato il CSS, carica il JS
                    return fetch('game.js');
                })
                .then(response => response.text())
                .then(js => {
                    // Codifica il JS in base64 per nasconderlo
                    const encodedJs = btoa(unescape(encodeURIComponent(js)));
                    // Esegui il codice JS decodificandolo al volo
                    loadScript(encodedJs);
                });

            // Carica i file audio
            ['correct.mp3', 'incorrect.mp3', 'levelup.mp3'].forEach((file, i) => {
                const audio = document.createElement('audio');
                audio.id = file.split('.')[0] + '-sound';
                audio.src = file;
                document.body.appendChild(audio);
            });
        }

        // Avvia l'applicazione quando il documento è pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>